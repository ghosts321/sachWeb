cmx.g.regist('CounterpartstatusStr', new HashMap());
cmx.g.regist('reportId', '');

cmx.g.CounterpartstatusStr.put('101', '填报中');
cmx.g.CounterpartstatusStr.put('201', '国家局处理中');
cmx.g.CounterpartstatusStr.put('202', '国家局处理中');
cmx.g.CounterpartstatusStr.put('203', '国家局处理中');
cmx.g.CounterpartstatusStr.put('204', '国家局处理中');
cmx.g.CounterpartstatusStr.put('205', '国家局处理中');
cmx.g.CounterpartstatusStr.put('206', '国家局处理中');
cmx.g.CounterpartstatusStr.put('207', '国家局处理中');
cmx.g.CounterpartstatusStr.put('208', '国家局处理中');
cmx.g.CounterpartstatusStr.put('209', '国家局处理中');
cmx.g.CounterpartstatusStr.put('210', '审批结束');
cmx.g.CounterpartstatusStr.put('213', '国家局处理中');
cmx.g.CounterpartstatusStr.put('214', '国家局处理中');
cmx.g.CounterpartstatusStr.put('215', '国家局处理中');
cmx.g.CounterpartstatusStr.put('216', '国家局处理中');
cmx.g.CounterpartstatusStr.put('223', '国家局处理中');
cmx.g.CounterpartstatusStr.put('224', '国家局处理中');
cmx.g.CounterpartstatusStr.put('225', '国家局处理中');
cmx.g.CounterpartstatusStr.put('226', '国家局处理中');
cmx.g.CounterpartstatusStr.put('301', '国家局退回');
cmx.g.CounterpartstatusStr.put('302', '国家局退回');
cmx.g.CounterpartstatusStr.put('303', '国家局处理中');
cmx.g.CounterpartstatusStr.put('304', '国家局处理中');
cmx.g.CounterpartstatusStr.put('305', '国家局处理中');

cmx.g.CounterpartstatusStr.put('401', '填报中');
cmx.g.CounterpartstatusStr.put('501', '省局处理中');
cmx.g.CounterpartstatusStr.put('502', '省局审核中');
cmx.g.CounterpartstatusStr.put('503', '待报备');
cmx.g.CounterpartstatusStr.put('504', '审批结束');
cmx.g.CounterpartstatusStr.put('505', '省局退回');
cmx.g.CounterpartstatusStr.put('601', '专家处理中');

cmx.g.CounterpartstatusStr.put('499', '国家局处理中'); //考古处处理中（已受理）
cmx.g.CounterpartstatusStr.put('987', '国家局处理中'); //考古处处理中
cmx.g.CounterpartstatusStr.put('701', '发掘资质单位处理中');
cmx.g.CounterpartstatusStr.put('702', '省局处理中');
cmx.g.CounterpartstatusStr.put('773', '国家局处理中'); //待发执照
cmx.g.CounterpartstatusStr.put('776', '国家局处理中'); //考古处转办
cmx.g.CounterpartstatusStr.put('777', '国家局处理中'); //考古处虚拟账号已下载过excel
cmx.g.CounterpartstatusStr.put('481', '国家局退回'); //考古处虚拟账号退回给发掘资质单位 一次性补正
cmx.g.CounterpartstatusStr.put('482', '国家局退回'); //考古处虚拟账号退回给发掘资质单位 不予受理
cmx.g.CounterpartstatusStr.put('993', '国家局退回'); //考古处虚拟账号退回给申请领队  一次性补正
cmx.g.CounterpartstatusStr.put('994', '国家局退回'); //考古处虚拟账号退回给申请领队 不予受理
cmx.g.CounterpartstatusStr.put('497', '国家局退回'); //考古处虚拟账号退回给文书室 一次性补正
cmx.g.CounterpartstatusStr.put('498', '国家局退回'); //考古处虚拟账号退回给文书室 不予受理
cmx.g.CounterpartstatusStr.put('495', '国家局退回'); //考古处虚拟账号退回给司密 一次性补正
cmx.g.CounterpartstatusStr.put('496', '国家局退回'); //考古处虚拟账号退回给司密 不予受理
cmx.g.CounterpartstatusStr.put('493', '国家局退回'); //考古处虚拟账号退回给省局 一次性补正
cmx.g.CounterpartstatusStr.put('494', '国家局退回'); //考古处虚拟账号退回给省局 不予受理
cmx.g.CounterpartstatusStr.put('877', '国家局退回'); //司秘账号退回给文书室 一次性补正
cmx.g.CounterpartstatusStr.put('878', '国家局退回'); //司秘账号退回给文书室 不予受理
cmx.g.CounterpartstatusStr.put('879', '国家局退回'); //司秘账号退回给文书室 退回
cmx.g.CounterpartstatusStr.put('874', '国家局退回'); //司秘账号退回给省局 一次性补正
cmx.g.CounterpartstatusStr.put('876', '国家局退回'); //司秘账号退回给省局 不予受理
cmx.g.CounterpartstatusStr.put('875', '国家局退回'); //司秘账号退回给省局 退回
cmx.g.CounterpartstatusStr.put('883', '国家局退回'); //司秘账号退回给发掘资质单位 一次性补正
cmx.g.CounterpartstatusStr.put('884', '国家局退回'); //司秘账号退回给发掘资质单位 不予受理
cmx.g.CounterpartstatusStr.put('885', '国家局退回'); //司秘账号退回给发掘资质单位 退回
cmx.g.CounterpartstatusStr.put('887', '国家局退回'); //司秘账号退回给发掘申请领队 一次性补正
cmx.g.CounterpartstatusStr.put('886', '国家局退回'); //司秘账号退回给发掘申请领队 不予受理
cmx.g.CounterpartstatusStr.put('888', '国家局退回'); //司秘账号退回给发掘申请领队 退回
cmx.g.CounterpartstatusStr.put('864', '国家局退回'); //文书室账号退回给省局 一次性补正
cmx.g.CounterpartstatusStr.put('866', '国家局退回'); //文书室账号退回给省局 不予受理
cmx.g.CounterpartstatusStr.put('865', '国家局退回'); //文书室账号退回给省局 退回
cmx.g.CounterpartstatusStr.put('873', '国家局退回'); //文书室账号退回给发掘资质单位 一次性补正
cmx.g.CounterpartstatusStr.put('872', '国家局退回'); //文书室账号退回给发掘资质单位 不予受理
cmx.g.CounterpartstatusStr.put('871', '国家局退回'); //文书室账号退回给发掘资质单位 退回
cmx.g.CounterpartstatusStr.put('867', '国家局退回'); //文书室账号退回给申请领队 一次性补正
cmx.g.CounterpartstatusStr.put('868', '国家局退回'); //文书室账号退回给申请领队 不予受理
cmx.g.CounterpartstatusStr.put('869', '国家局退回'); //文书室账号退回给申请领队 退回
cmx.g.CounterpartstatusStr.put('980', '省局退回'); //省局账号退回给发掘资质单位 一次性补正
cmx.g.CounterpartstatusStr.put('982', '省局退回'); //省局账号退回给发掘资质单位 不予受理
cmx.g.CounterpartstatusStr.put('981', '省局退回'); //省局账号退回给发掘资质单位 退回
cmx.g.CounterpartstatusStr.put('990', '省局退回'); //省局账号退回给申请领队 一次性补正
cmx.g.CounterpartstatusStr.put('992', '省局退回'); //省局账号退回给申请领队 不予受理
cmx.g.CounterpartstatusStr.put('991', '省局退回'); //省局账号退回给申请领队 退回
cmx.g.CounterpartstatusStr.put('880', '发掘资质单位退回'); //发掘资质单位账号退回给申请领队 一次性补正
cmx.g.CounterpartstatusStr.put('882', '发掘资质单位退回'); //发掘资质单位账号退回给申请领队 不予受理
cmx.g.CounterpartstatusStr.put('881', '发掘资质单位退回'); //发掘资质单位账号退回给申请领队 退回
cmx.g.CounterpartstatusStr.put('999', '不同意发掘'); //同210也是办结状态，只是结果为不同意发掘

cmx.g.CounterpartstatusStr.put('230', '国家局处理中');
cmx.g.CounterpartstatusStr.put('231', '国家局处理中');
cmx.g.CounterpartstatusStr.put('232', '国家局处理中');
cmx.g.CounterpartstatusStr.put('250', '国家局处理中');
cmx.g.CounterpartstatusStr.put('901', '申请人已撤销'); //属于已办
cmx.g.CounterpartstatusStr.put('902', '管理员办结'); //属于办结

//导入的系统数据的状态
cmx.g.CounterpartstatusStr.put('W08', '已报备'); //办结
cmx.g.CounterpartstatusStr.put('W06', '国家局批复通过'); //办结
cmx.g.CounterpartstatusStr.put('W6', '国家局批复通过');
cmx.g.CounterpartstatusStr.put('W999', '作废');
cmx.g.CounterpartstatusStr.put('W07', '批复不通过');
cmx.g.CounterpartstatusStr.put('W088', '纸质办结');
cmx.g.CounterpartstatusStr.put('W0998', '办结');
cmx.g.CounterpartstatusStr.put('W099', '纸质办结');
cmx.g.CounterpartstatusStr.put('W081', '省委托第三方审核通过');
cmx.g.CounterpartstatusStr.put('W082', '省委托第三方审核不通过');
cmx.g.CounterpartstatusStr.put('W02', '初审退回');
cmx.g.CounterpartstatusStr.put('W022', '整改退回');
cmx.g.CounterpartstatusStr.put('W033', '国家局发文撰写中');
cmx.g.CounterpartstatusStr.put('W034', '国家局发文审核中');
cmx.g.CounterpartstatusStr.put('W053', '国家局发文请专家评审中');
cmx.g.CounterpartstatusStr.put('W092', '已转OA专家评审中'); //'092','国家局发文请专家评审中';
cmx.g.CounterpartstatusStr.put('W093', '已转OA专家评审完成');
cmx.g.CounterpartstatusStr.put('W031', '国家局发文处理中');
cmx.g.CounterpartstatusStr.put('W01', '填报中');
cmx.g.CounterpartstatusStr.put('W021', '国家局退回');
cmx.g.CounterpartstatusStr.put('W041', '省委托第三方处理中');
cmx.g.CounterpartstatusStr.put('W045', '国家局委托第三方请专家评审完成');
cmx.g.CounterpartstatusStr.put('W047', '收藏单位处理中');
cmx.g.CounterpartstatusStr.put('W051', '国家局请专家评审中');
cmx.g.CounterpartstatusStr.put('W054', '国家局委托第三方审核通过');
cmx.g.CounterpartstatusStr.put('W083', '国家局委托第三方审核完成');
cmx.g.CounterpartstatusStr.put('W09', '已下载文件');
cmx.g.CounterpartstatusStr.put('W6K', '考古办结');

cmx.route.view({
    index: 'gethaveToDoList',
    resolve: function (result) {
        // console.log(result);
        var param = result.data;
        if (param.length <= 0)
            return;
        var data = param.dataList;
        console.log(data);
        cmx.g.haveToDoData = data;
        var pageSize = param.pageSize;
        var pageNumber = param.pageNumber;
        $("#cmx-htd-tbody").html('');
        for (var i = 0; i < data.length; i++) {
            var tbody_html = '';
            // console.log(data[i].status)
            // var relic_city = !IsEmpty(data[i].city) ? data[i].city : '';
            tbody_html = ['<tr>',
                '<td class="text-center">',
                i + 1,
                '</td>',
                '<td><button class="btn btn-default complete-report btn-sm">报备</button></td>',
                '<td>' + (IsEmpty(data[i].proFileTitle) ? '无省文件' : data[i].proFileTitle) + '</td>',
                '<td>' + data[i].projectNumName + '</td>',
                '<td style="color:#f2a654;">' + cmx.g.CounterpartstatusStr.get(data[i].status) + '</td>',
                '<td>' + (IsEmpty(data[i].receivedTime) ? '无' : data[i].receivedTime) + '</td>',
                '<td>' + (IsEmpty(data[i].protectUnitName) || data[i].protectUnitName == 'null' ? '无' : data[i].protectUnitName) + '</td>',
                '<td>' + (IsEmpty(data[i].publishTypeName) || data[i].publishTypeName == 'null' ? '无' : data[i].publishTypeName) + '</td>',
                '<td>' + (data[i].originalNo.length <= 6 ? '无' : data[i].originalNo) + '</td>',
                '<td>' + data[i].projectName + '</td>',
                '<td>' + data[i].networkNum + '</td>',
                '<td>' + (IsEmpty(data[i].refNumber) || (data[i].refNumber + '').indexOf('null') >= 0 ? '' : data[i].refNumber) + '</td>',
                '<td>' + (IsEmpty(data[i].sendDate) || data[i].sendDate == '月日' ? '' : data[i].sendDate) + '</td>',
                '</tr>'
            ].join("");
            $("#cmx-htd-tbody").append(tbody_html);
        }
        $('#cmx-phavePage .nowpage').html(pageNumber);
        $('#cmx-phavePage .jumppage').val(pageNumber);
        $('#cmx-phavePage .totalpage').html(param.pages);
        haveFunc.pageCount = param.pages;
        console.log(haveFunc.pageCount);

        if (GetUrlParamString('type') == 1) { //博物馆 国保单位 
            $("#cmx-htd-tbody .complete-report").each(function (index) {
                var temp = data[index];
                $("#cmx-htd-tbody .complete-report").each(function (index) {
                    $(this).next().hide();
                    var temp = data[index];
                    if (temp.projectNum == "56014_b" || temp.projectNum == "56014_c" || temp.projectNum == "56014_e" || temp.projectNum == "56022_c") {
                        if (temp.reportFlag == 2) {
                            $(this).text('查看报备');
                            $(this).on('click', function () {
                                event.stopPropagation();
                                $("#completeReportModal1").off('hide.bs.modal');
                                $("#completeReportModal1").off('shown.bs.modal');
                                $("#completeReportModal1").on('shown.bs.modal', function () {
                                    new cmx.process().
                                    turn('initFiles', {
                                        'P002': '321',
                                    }).start();
                                    $('#cmx-report-form1').html('');
                                    loadData({
                                        url: getBaoBeiJson,
                                        element: '#cmx-report-form1'
                                    });
                                    new cmx.process()
                                        .turn('callajax', {
                                            url: api_ea + '/eaPubEndReportInfo/getDataByParam',
                                            data: JSON.stringify({
                                                token: getData('token'), //类型：String  必有字段  备注：无
                                                projectNum: temp.projectNum, //类型：String  必有字段  备注：项目编号                                                
                                                applyId: temp.applyId //类型：String  必有字段  备注：申请ID
                                            }),
                                            type: 'POST'
                                        })
                                        .turn(function (prevModelData, send, abort) {
                                            if (!IsNull(prevModelData) && prevModelData.state == '200' && !IsEmpty(prevModelData.data) && prevModelData.data != 'null') {
                                                cmx.g.applyId = prevModelData.data[0].applyId;
                                                $('#cmx-report-form1 #cmx-i-1').val(prevModelData.data[0].remark).attr('readonly', true);
                                                $('#cmx-report-form-btn1').hide();
                                                new cmx.process()
                                                    .turn('buildFileList', {
                                                        projectNum: prevModelData.data[0].projectNum
                                                    })
                                                    .start();
                                                $('#P002').remove();
                                                $('.remove-btn').remove();
                                            } else {
                                                showAlert({
                                                    type: 'error',
                                                    content: prevModelData.msg
                                                });
                                            }
                                            send.go();
                                        })
                                        .start();
                                });
                                $("#completeReportModal1").on('hide.bs.modal', function () {
                                    $('#cmx-report-form-btn1').show();
                                    $('#cmx-report-form1').html('');
                                });
                                $("#completeReportModal1").modal('show');
                            });
                        } else {
                            $(this).on('click', function (event) {
                                event.stopPropagation();
                                $("#completeReportModal1").off('hide.bs.modal');
                                $("#completeReportModal1").off('shown.bs.modal');
                                $("#completeReportModal1").on('shown.bs.modal', function () {
                                    new cmx.process().
                                    turn('initFiles', {
                                        'P002': '321',
                                    }).start();

                                    loadData({
                                        url: getBaoBeiJson,
                                        element: '#cmx-report-form1'
                                    });
                                    $('#cmx-report-form-btn1').unbind('click');
                                    $('#cmx-report-form-btn1').bind('click', function () {
                                        var temp_flag = checkFormLength('#cmx-cmx-report-form1');
                                        if (!temp_flag) {
                                            return;
                                        }
                                        // if (IsEmpty($('#cmx-report-form1 #cmx-i-1').val())) {
                                        //     showAlert({
                                        //         type: 'error',
                                        //         content: '意见不能为空'
                                        //     });
                                        //     return;
                                        // }
                                        // if (getFileListForSave(cmx.g.filelinkfileclass).length <= 0) {
                                        //     showAlert({
                                        //         type: 'error',
                                        //         content: '报备文件不能为空'
                                        //     });
                                        //     return;
                                        // }
                                        new cmx.process()
                                            .turn('callajax', {
                                                url: api_ea + '/eaPubEndReportInfo/sendEaPubEndReportInfo',
                                                data: JSON.stringify({
                                                    token: getData('token'), //类型：String  必有字段  备注：无
                                                    reptFormData: [{
                                                        remark: $('#cmx-report-form1 #cmx-i-1').val(),
                                                        projectNum: temp.projectNum, //类型：String  必有字段  备注：项目编号                                                
                                                        files: getFileListForSave(cmx.g.filelinkfileclass),
                                                        applyId: temp.applyId //类型：String  必有字段  备注：申请ID
                                                    }]
                                                }),
                                                type: 'POST'
                                            }).turn(function (prevModelData, send, abort) {
                                                if (!IsNull(prevModelData) && prevModelData.state == '200' && !IsEmpty(prevModelData.data) && prevModelData.data != 'null') {
                                                    showAlert({
                                                        type: 'success',
                                                        content: '报备成功'
                                                    });
                                                    $("#completeReportModal1").modal('hide');
                                                    haveFunc.getHaveToDo();
                                                } else {
                                                    showAlert({
                                                        type: 'error',
                                                        content: prevModelData.msg
                                                    });
                                                }
                                                send.go();
                                            })
                                            .start();
                                    });
                                });
                                $("#completeReportModal1").on('hide.bs.modal', function () {
                                    $('#cmx-report-form-btn1').show();
                                    $('#cmx-report-form1').html('');
                                });
                                $("#completeReportModal1").modal('show');
                            });
                        }
                    } else {
                        $(this).remove();
                    }
                });
            });
        } else if (GetUrlParamString('type') == 2) { //考古领队
            $("#cmx-htd-tbody .complete-report").each(function (index) {
                temp = data[index];
                if (temp.reportFlag == 2) {
                    $(this).text('查看报备');
                    $(this).on('click', function () {
                        event.stopPropagation();
                        $('#cmx-report-form-btn').hide();
                        $('#cmx-report-form-send').hide();
                        $("#completeReportModal").off('hide.bs.modal');
                        $("#completeReportModal").off('shown.bs.modal');
                        $("#completeReportModal").on('shown.bs.modal', function () {
                            new cmx.process().
                            turn('initFiles', {
                                'P002': '321',
                                'P003': '322'
                            }).start();
                            $('#cmx-report-form').html('');

                            loadData({
                                url: getKaoguBaoBeiJson,
                                element: '#cmx-report-form'
                            });
                            new cmx.process()
                                .turn('callajax', {
                                    url: api_ea + '/eaPubEndReportInfo/getDataByParam',
                                    data: JSON.stringify({
                                        token: getData('token'), //类型：String  必有字段  备注：无
                                        projectNum: temp.projectNum, //类型：String  必有字段  备注：项目编号                                                
                                        applyId: temp.applyId //类型：String  必有字段  备注：申请ID
                                    }),
                                    type: 'POST'
                                })
                                .turn(function (prevModelData, send, abort) {
                                    if (!IsNull(prevModelData) && prevModelData.state == '200' && !IsEmpty(prevModelData.data) && prevModelData.data != 'null') {
                                        if (prevModelData.data.length != 0) {
                                            cmx.g.applyId = prevModelData.data[0].applyId;
                                            $('#cmx-report-form #cmx-i-0').val(prevModelData.data[0].content1).attr('readonly', true);
                                            $('#cmx-report-form #cmx-i-1').val(prevModelData.data[0].content2).attr('readonly', true);
                                            if (prevModelData.data[0].content3 == 1) {
                                                $('#cmx-report-form #cmx-i-4-1').attr('checked', true).attr('readonly', true);
                                            }
                                            new cmx.process()
                                                .turn('buildFileList', {
                                                    projectNum: prevModelData.data[0].projectNum
                                                })
                                                .start();
                                            $('.remove-btn').hide();
                                            cmx.g.reportId = prevModelData.data[0].reportId;
                                            $('#cmx-report-form #cmx-i-0').attr('readonly', true);
                                            $('#cmx-report-form #cmx-i-1').attr('readonly', true);
                                            $('#cmx-report-form #cmx-i-4-1').attr('disabled', true);
                                            $('#P002').hide();
                                            $('#P003').hide();
                                            $('.remove-btn').hide();

                                        }
                                    } else {
                                        showAlert({
                                            type: 'error',
                                            content: prevModelData.msg
                                        });
                                    }
                                    send.go();
                                })
                                .start();
                        });
                        $("#completeReportModal").on('hide.bs.modal', function () {
                            $('#cmx-report-form-btn').show();
                            $('#cmx-report-form').html('');
                        });
                        $("#completeReportModal").modal('show');
                    });
                } else {
                    $(this).on('click', function (event) {
                        event.stopPropagation();
                        $("#completeReportModal").off('hide.bs.modal');
                        $("#completeReportModal").off('shown.bs.modal');
                        $("#completeReportModal").on('shown.bs.modal', function () {
                            new cmx.process().
                            turn('initFiles', {
                                'P002': '321',
                                'P003': '322'
                            }).start();
                            loadData({
                                url: getKaoguBaoBeiJson,
                                element: '#cmx-report-form'
                            });
                            $('#cmx-report-form-btn').show();
                            $('#cmx-report-form-send').show();
                            if (temp.reportFlag == 1) {
                                new cmx.process()
                                    .turn('callajax', {
                                        url: api_ea + '/eaPubEndReportInfo/getDataByParam',
                                        data: JSON.stringify({
                                            token: getData('token'), //类型：String  必有字段  备注：无
                                            projectNum: temp.projectNum, //类型：String  必有字段  备注：项目编号                                                
                                            applyId: temp.applyId //类型：String  必有字段  备注：申请ID
                                        }),
                                        type: 'POST'
                                    })
                                    .turn(function (prevModelData, send, abort) {
                                        if (!IsNull(prevModelData) && prevModelData.state == '200' && !IsEmpty(prevModelData.data) && prevModelData.data != 'null') {
                                            if (prevModelData.data.length != 0) {
                                                cmx.g.applyId = prevModelData.data[0].applyId;
                                                $('#cmx-report-form #cmx-i-0').val(prevModelData.data[0].content1);
                                                $('#cmx-report-form #cmx-i-1').val(prevModelData.data[0].content2);
                                                if (prevModelData.data[0].content3 == 1) {
                                                    $('#cmx-report-form #cmx-i-4-1').attr('checked', true);
                                                }
                                                new cmx.process()
                                                    .turn('buildFileList', {
                                                        projectNum: prevModelData.data[0].projectNum
                                                    })
                                                    .start();
                                                cmx.g.reportId = prevModelData.data[0].reportId;
                                            }
                                        } else {
                                            showAlert({
                                                type: 'error',
                                                content: prevModelData.msg
                                            });
                                        }
                                        send.go();
                                    })
                                    .start();
                            } else {
                                cmx.g.reportId = '';
                            }
                            //保存
                            $('#cmx-report-form-btn').unbind('click');
                            $('#cmx-report-form-btn').bind('click', function () {
                                //基本表单验证
                                var temp_flag = checkFormLength('#cmx-report-form');
                                if (!temp_flag) {
                                    return;
                                }
                                new cmx.process()
                                    .turn('callajax', {
                                        url: api_ea + '/eaPubEndReportInfo/saveEaPubEndReportInfo',
                                        data: JSON.stringify({
                                            token: getData('token'), //类型：String  必有字段  备注：无
                                            reptFormData: [{
                                                remark: '',
                                                projectNum: temp.projectNum, //类型：String  必有字段  备注：项目编号                                                
                                                files: getFileListForSave(cmx.g.filelinkfileclass),
                                                applyId: temp.applyId, //类型：String  必有字段  备注：申请ID
                                                content1: $('#cmx-report-form #cmx-i-0').val(),
                                                content2: $('#cmx-report-form #cmx-i-1').val(),
                                                content3: ($('#cmx-report-form #cmx-i-4-1').is(':checked')) ? 1 : 2,
                                                reportId: cmx.g.reportId
                                            }]
                                        }),
                                        type: 'POST'
                                    }).turn(function (prevModelData, send, abort) {
                                        if (!IsNull(prevModelData) && prevModelData.state == '200' && !IsEmpty(prevModelData.data) && prevModelData.data != 'null') {
                                            showAlert({
                                                type: 'success',
                                                content: '保存成功'
                                            });
                                            $("#completeReportModal").modal('hide');
                                            haveFunc.getHaveToDo();
                                        } else {
                                            showAlert({
                                                type: 'error',
                                                content: prevModelData.msg
                                            });
                                        }
                                        send.go();
                                    })
                                    .start();
                            });
                            //发送
                            $('#cmx-report-form-send').unbind('click');
                            $('#cmx-report-form-send').bind('click', function () {
                                //基本表单验证
                                var temp_flag = checkFormLength('#cmx-report-form');
                                if (!temp_flag) {
                                    return;
                                }
                                new cmx.process()
                                    .turn('callajax', {
                                        url: api_ea + '/eaPubEndReportInfo/sendEaPubEndReportInfo',
                                        data: JSON.stringify({
                                            token: getData('token'), //类型：String  必有字段  备注：无
                                            reptFormData: [{
                                                remark: '',
                                                projectNum: temp.projectNum, //类型：String  必有字段  备注：项目编号                                                
                                                files: getFileListForSave(cmx.g.filelinkfileclass),
                                                applyId: temp.applyId, //类型：String  必有字段  备注：申请ID
                                                content1: $('#cmx-report-form #cmx-i-0').val(),
                                                content2: $('#cmx-report-form #cmx-i-1').val(),
                                                content3: ($('#cmx-report-form #cmx-i-4-1').is(':checked')) ? 1 : 2,
                                                reportId: cmx.g.reportId
                                            }]
                                        }),
                                        type: 'POST'
                                    }).turn(function (prevModelData, send, abort) {
                                        if (!IsNull(prevModelData) && prevModelData.state == '200' && !IsEmpty(prevModelData.data) && prevModelData.data != 'null') {
                                            showAlert({
                                                type: 'success',
                                                content: '发送成功'
                                            });
                                            $("#completeReportModal").modal('hide');
                                            haveFunc.getHaveToDo();
                                        } else {
                                            showAlert({
                                                type: 'error',
                                                content: prevModelData.msg
                                            });
                                        }
                                        send.go();
                                    })
                                    .start();
                            });
                        });
                        $("#completeReportModal").on('hide.bs.modal', function () {
                            $('#cmx-report-form-btn').show();
                            $('#cmx-report-form').html('');
                        });
                        $("#completeReportModal").modal('show');
                    });
                }
            });
        } else if (GetUrlParamString('type') == 3) { //考古发掘资质单位
            $("#cmx-htd-tbody .complete-report").hide();
        } else {
            $("#cmx-htd-tbody .complete-report").hide();
        }
        $("#cmx-htd-tbody tr").each(function (index) {
            var _self = $(this);
            $(this).unbind('click');
            $(this).bind('click', function () {
                $("#cmx-htd-tbody tr").each(function () {
                    $(this).removeClass("active");
                })
                _self.addClass("active");
                new cmx.process()
                // .turn('jumpToApply', {
                //     index: index,
                //     data: cmx.g.haveToDoData,
                //     isUse: false
                // }).start();
                window.location.href = '/app/f-gover-approval/applyinfo.html?from=undefied&status=' + data[index].status + '&applyId=' + data[index].applyId + '&projectNum=' + data[index].projectNum + '&nowid=' + GetUrlParamString('nowid');
            });
        });

    },
    reject: function (data) {

    }
});

cmx.route.view({
    index: 'projectNumByUserInit',
    resolve: function (result) {
        var projectNumList = result.data;
        var treeData = new projectNumtreeMenu(projectNumList, {
            pitemIdStr: 'pitemId',
            itemNameStr: 'itemName',
            itemIdStr: 'itemId',
            selectedId: $('#projectNum').val()
        }).init(0);
        var finaldata = [{
            "id": 'root',
            "text": "筛选事项",
            "children": treeData,
            "state": {
                "opened": true,
                "selected": false
            }
        }];
        $('.project-num-tree-body').jstree('destroy');
        $('.project-num-tree-body').jstree({ // 内嵌数据
            'core': {
                'data': finaldata,
                'multiple': false
            }
        }).on("changed.jstree", function (e, datas) {
            if (datas.selected.length > 0) {
                var treeId = datas.instance.get_node(datas.selected[0]).id;
                var treechildren = datas.instance.get_node(datas.selected[0]).children;

                if (treeId == 'root') {
                    return;
                }
                if (treechildren.length > 0) {
                    treeId = treeId + '_';
                }
                var treeText = datas.instance.get_node(datas.selected[0]).text;
                if ($('#projectNum').val() != treeId) {
                    $('#select-applynum-input').webuiPopover('hide');
                }
                $('#select-applynum-input').val(treeText);
                $('#projectNum').val(treeId);
                haveFunc.getHaveToDo();
                //L(datas.instance.get_node(datas.selected[0]));
            }
        });
    }
});